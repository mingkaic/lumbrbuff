<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Abseil Logs</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: monospace; background: #1e1e1e; color: #d4d4d4; }
        .ERROR { color: #f44336; font-weight: bold; }
        .INFO { color: #4caf50; }
        table { width: 100%; border-collapse: collapse; }
        td, th { padding: 8px; border-bottom: 1px solid #333; text-align: left; }
    </style>
</head>
<body>
    <h2>Live Log Stream</h2>
    <table id="log-table">
        <tr><th>Time</th><th>Level</th><th>Source</th><th>Message</th></tr>
    </table>

    <script>
        const table = document.getElementById('log-table');

        function addLogRow(data, prepend = false) {
            const row = table.insertRow(1);
            row.className = data.severity;
            row.innerHTML = `<td>${data.timestamp}</td><td>${data.severity}</td>
                             <td>${data.file}:${data.line}</td><td>${data.message}</td>`;
        }

        const socket = io();
        socket.on('log_history', (logs) => {
            console.log("Loading historical logs:", logs.length);

            logs.forEach(log => {
                addLogRow(log);
            });
        });
        socket.on('new_log', (data) => {
            addLogRow(data);
        });
    </script>
</body>
</html>
